# Домашнее задание к занятию "4.1. Командная оболочка Bash: Практические навыки"

## Обязательные задания

1. Есть скрипт:
	```bash
	a=1
	b=2
	c=a+b
	d=$a+$b
	e=$(($a+$b))
	```
	* Какие значения переменным c,d,e будут присвоены?
	* Почему?
        - **Переменная `c` будет равна `a+b`, т.к. это не переменные, а простая строка**
        - **Переменная 'd' будет равна `1+2`, т.к. в переменные записаны строки**
        - **Переменная 'd' будет равна `3`, т.к. конструкция `$((...))` создана для арифметических операций с числами**

1. На нашем локальном сервере упал сервис и мы написали скрипт, который постоянно проверяет его доступность, записывая дату проверок до тех пор, пока сервис не станет доступным. В скрипте допущена ошибка, из-за которой выполнение не может завершиться, при этом место на Жёстком Диске постоянно уменьшается. Что необходимо сделать, чтобы его исправить:
	```bash
	while ((1==1)
	do
	curl https://localhost:4757
	if (($? != 0))
	then
	date >> curl.log
	fi
	done
	```
    - **Пропущена вторая скобка рядом с условием `while`**
    - **Отсутствует `else` в условном выражении в котором нужно было добавить `break` для выхода из цикла если успешно проверенна доустпность**
    - **Так-же предположу что для избежания заполнения места, в случии зацикливания, нужно перенаправить вывод команды `curl` в `/dev/null`**

1. Необходимо написать скрипт, который проверяет доступность трёх IP: 192.168.0.1, 173.194.222.113, 87.250.250.242 по 80 порту и записывает результат в файл log. Проверять доступность необходимо пять раз для каждого узла.
    ```bash
    #!/usr/bin/env bash
    
    AR_IP=(192.168.0.1 173.194.222.113 87.250.250.242)
    PORT=80
    LOG_NAME=log
    
    for ip in ${AR_IP[@]}
    do
        for count in {1..5}
        do    
            curl $ip:$PORT &>/dev/null
            if (($?==0))
            then
                 echo success $ip $count >> $LOG_NAME
            else
                 echo fail $ip $count >> $LOG_NAME
            fi
        done 
    done
   ``` 
1. Необходимо дописать скрипт из предыдущего задания так, чтобы он выполнялся до тех пор, пока один из узлов не окажется недоступным. Если любой из узлов недоступен - IP этого узла пишется в файл error, скрипт прерывается
    ```bash
    #!/usr/bin/env bash
    
    AR_IP=(192.168.0.1 250.194.222.113 87.250.250.242)
    PORT=80
    LOG_NAME=log
    ERROR_NAME=error
    
    for ip in ${AR_IP[@]}
    do
        for count in {1..5}
        do    
            curl $ip:$PORT &>/dev/null
            if (($?==0))
            then
                 echo success $ip $count >> $LOG_NAME
            else
                 echo fail $ip $count >> $ERROR_NAME
                 break 2
            fi
        done 
    done
    ``` 

## Дополнительное задание (со звездочкой*) - необязательно к выполнению

Мы хотим, чтобы у нас были красивые сообщения для коммитов в репозиторий. Для этого нужно написать локальный хук для git, который будет проверять, что сообщение в коммите содержит код текущего задания в квадратных скобках и количество символов в сообщении не превышает 30. Пример сообщения: \[04-script-01-bash\] сломал хук.
    - **Добавил файл `commit-msg` в папку `.git/hooks` с содержимым:**
```bash
PATERN="^\[.*\].*$"
commit_msg=$(cat $1)
error=false
error_msg=""
format_error=" Dont match to format"
length_error=", Commit msg length too match"

if [[ ! $commit_msg =~ $PATERN ]]
then
    error=true
    error_msg=$error_msg$format_error
fi

commit_msg_length=$(expr length $commit_msg)
if [[ $commit_msg_length -ge 10 ]]
then
     error=true
     error_msg=$error_msg$length_error
fi


if $error
then
    echo >&2 $error_msg
    exit 1
fi
```

---

### Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---
